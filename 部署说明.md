# NetBird VPN éƒ¨ç½²è¯´æ˜ï¼ˆPostgreSQLç‰ˆæœ¬ï¼‰

## ğŸ¯ å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

æœ¬éƒ¨ç½²åŒ…æä¾›äº†åŸºäºå®˜æ–¹æ–‡æ¡£æ ‡å‡†åŒ–çš„ NetBird VPN è‡ªæ‰˜ç®¡è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ PostgreSQL æ•°æ®åº“ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚

## ğŸ“¦ æ–‡ä»¶æ¸…å•

```
014-netbird-vpn/
â”œâ”€â”€ ğŸ“„ docker-compose.yml    # ä¸»é…ç½®æ–‡ä»¶ï¼ˆ5ä¸ªæœåŠ¡ï¼‰
â”œâ”€â”€ ğŸ“„ turnserver.conf       # Coturn STUN/TURN é…ç½®
â”œâ”€â”€ ğŸ“œ deploy.sh            # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ ğŸ“š README.md            # è¯¦ç»†æ–‡æ¡£
â””â”€â”€ ğŸ“‹ éƒ¨ç½²è¯´æ˜.md          # å¿«é€ŸæŒ‡å—ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## ğŸš€ ä¸€é”®éƒ¨ç½²

### 1. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
```bash
# ä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨çš„ /tmp ç›®å½•
scp -r 014-netbird-vpn/ user@120.50.145.50:/tmp/
```

### 2. æ‰§è¡Œéƒ¨ç½²
```bash
# SSH è¿æ¥åˆ°æœåŠ¡å™¨
ssh user@120.50.145.50

# è¿›å…¥ç›®å½•
cd /tmp/014-netbird-vpn/

# æ‰§è¡Œä¸€é”®éƒ¨ç½²
chmod +x deploy.sh
./deploy.sh
```

### 3. é€‰æ‹©é…ç½®æ¨¡å¼
éƒ¨ç½²è¿‡ç¨‹ä¸­ä¼šæç¤ºé€‰æ‹©ï¼š

**ğŸŒ åŸŸåæ¨¡å¼ï¼ˆæ¨èï¼‰**
- æ”¯æŒ HTTPS å’Œ Let's Encrypt è‡ªåŠ¨è¯ä¹¦
- è®¿é—®åœ°å€ï¼š`https://your.domain.com:8080`
- éœ€è¦æä¾›åŸŸåå’Œç®¡ç†å‘˜é‚®ç®±

**ğŸ“ IPæ¨¡å¼ï¼ˆæµ‹è¯•ï¼‰**
- ä½¿ç”¨ HTTP åè®®
- è®¿é—®åœ°å€ï¼š`http://120.50.145.50:8080`
- é€‚åˆå¿«é€Ÿæµ‹è¯•å’Œå†…ç½‘éƒ¨ç½²

## ğŸ›ï¸ æœåŠ¡è®¿é—®

### Web ç®¡ç†ç•Œé¢
- **åŸŸåæ¨¡å¼**: `https://your.domain.com:8080`
- **IPæ¨¡å¼**: `http://120.50.145.50:8080`

### ç®¡ç† API
- **åŸŸåæ¨¡å¼**: `https://your.domain.com:33073`
- **IPæ¨¡å¼**: `http://120.50.145.50:33073`

### æœåŠ¡ç«¯å£åˆ†å¸ƒ
```
8080  â†’ Dashboard (Webç•Œé¢)
33073 â†’ Management (API & gRPC)
10000 â†’ Signal (ä¿¡ä»¤æœåŠ¡)
33080 â†’ Relay (ä¸­ç»§æœåŠ¡)
3478  â†’ Coturn (STUN/TURN)
5432  â†’ PostgreSQL (æ•°æ®åº“)
```

## ğŸ—„ï¸ PostgreSQL æ•°æ®åº“

### ä¼˜åŠ¿å¯¹æ¯”
| ç‰¹æ€§ | SQLite (é»˜è®¤) | PostgreSQL (æœ¬æ–¹æ¡ˆ) |
|------|---------------|-------------------|
| å¹¶å‘æ€§èƒ½ | æœ‰é™ | ä¼˜ç§€ |
| æ•°æ®ä¸€è‡´æ€§ | åŸºç¡€ | å¼ºACID |
| å¤‡ä»½æ¢å¤ | æ–‡ä»¶æ‹·è´ | ä¸“ä¸šå·¥å…· |
| æ‰©å±•æ€§ | å—é™ | æ°´å¹³æ‰©å±• |
| é€‚ç”¨åœºæ™¯ | å°å‹éƒ¨ç½² | ç”Ÿäº§ç¯å¢ƒ |

### è¿æ¥ä¿¡æ¯
```
æ•°æ®åº“: netbird
ç”¨æˆ·å: netbird
å¯†ç : NetBirdDB2024!
ç«¯å£: 5432 (å†…éƒ¨)
```

## ğŸ”§ å¿«é€Ÿè¿ç»´

### åŸºæœ¬æ“ä½œ
```bash
cd /data/netbird

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down
```

### æ•°æ®åº“æ“ä½œ
```bash
# è¿æ¥æ•°æ®åº“
docker-compose exec postgres psql -U netbird -d netbird

# å¤‡ä»½æ•°æ®åº“
docker-compose exec postgres pg_dump -U netbird netbird > backup.sql

# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
docker-compose exec postgres pg_isready -U netbird -d netbird
```

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep -E ':(8080|33073|10000|33080|3478)'

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose logs [æœåŠ¡å]
```

### Q2: æ— æ³•è®¿é—®ç®¡ç†ç•Œé¢
```bash
# æ£€æŸ¥DashboardæœåŠ¡
docker-compose logs dashboard

# æ£€æŸ¥Management API
curl -f http://localhost:33073/api/status

# éªŒè¯ç½‘ç»œè¿æ¥
docker network inspect netbird_netbird
```

### Q3: æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“æ—¥å¿—
docker-compose logs postgres

# æµ‹è¯•è¿æ¥
docker-compose exec postgres pg_isready -U netbird -d netbird

# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker-compose exec management env | grep POSTGRES
```

## ğŸ“‹ éƒ¨ç½²åé…ç½®

### 1. è®¿é—®ç®¡ç†ç•Œé¢
- æ‰“å¼€æµè§ˆå™¨è®¿é—® Web ç•Œé¢
- åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·
- é…ç½®ç»„ç»‡ä¿¡æ¯

### 2. é…ç½®èº«ä»½è®¤è¯
- é€‰æ‹©èº«ä»½æä¾›å•†ï¼ˆIdPï¼‰
- æˆ–ä½¿ç”¨æœ¬åœ°ç”¨æˆ·è®¤è¯
- é…ç½®ç”¨æˆ·æ³¨å†Œç­–ç•¥

### 3. ç”Ÿæˆ Setup Key
- åœ¨ç®¡ç†ç•Œé¢åˆ›å»º Setup Key
- è®¾ç½®è¿‡æœŸæ—¶é—´å’Œä½¿ç”¨æ¬¡æ•°
- ç”¨äºå®¢æˆ·ç«¯è®¾å¤‡æ¥å…¥

### 4. å®¢æˆ·ç«¯éƒ¨ç½²
```bash
# Linux å®¢æˆ·ç«¯å®‰è£…
curl -fsSL https://pkgs.netbird.io/install.sh | sh

# ä½¿ç”¨ Setup Key è¿æ¥
netbird up --setup-key YOUR_SETUP_KEY
```

## ğŸ”’ å®‰å…¨å»ºè®®

### åŸºç¡€å®‰å…¨
- âœ… æ›´æ”¹é»˜è®¤å¯†ç ï¼ˆæ•°æ®åº“ã€TURNæœåŠ¡ï¼‰
- âœ… é…ç½®é˜²ç«å¢™ï¼ˆè„šæœ¬å·²è‡ªåŠ¨é…ç½®ï¼‰
- âœ… ä½¿ç”¨åŸŸåæ¨¡å¼å¯ç”¨ HTTPS
- âœ… å®šæœŸæ›´æ–°æœåŠ¡ç‰ˆæœ¬

### é«˜çº§å®‰å…¨
- ğŸ”§ é…ç½®åå‘ä»£ç†
- ğŸ”§ å¯ç”¨ WAFï¼ˆWebåº”ç”¨é˜²ç«å¢™ï¼‰
- ğŸ”§ é™åˆ¶ç®¡ç†ç•Œé¢è®¿é—®IP
- ğŸ”§ å¯ç”¨è®¿é—®æ—¥å¿—å®¡è®¡

## ğŸ“Š ç›‘æ§å»ºè®®

### æœåŠ¡å¥åº·æ£€æŸ¥
```bash
# æœåŠ¡çŠ¶æ€ç›‘æ§
docker-compose ps

# èµ„æºä½¿ç”¨ç›‘æ§
docker stats

# æ—¥å¿—ç›‘æ§
docker-compose logs --tail=100 | grep -i error
```

### æ•°æ®åº“ç›‘æ§
```bash
# è¿æ¥æ•°ç›‘æ§
docker-compose exec postgres psql -U netbird -d netbird -c "SELECT count(*) FROM pg_stat_activity;"

# æ•°æ®åº“å¤§å°
docker-compose exec postgres psql -U netbird -d netbird -c "SELECT pg_size_pretty(pg_database_size('netbird'));"
```

## ğŸ”„ å¤‡ä»½ç­–ç•¥

### è‡ªåŠ¨å¤‡ä»½è„šæœ¬
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /data/netbird/backup.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/data/netbird/backups"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
docker-compose exec postgres pg_dump -U netbird netbird > $BACKUP_DIR/netbird_db_$DATE.sql

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf $BACKUP_DIR/netbird_config_$DATE.tar.gz \
  docker-compose.yml turnserver.conf config/

# æ¸…ç†7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "Backup completed: $DATE"
EOF

chmod +x /data/netbird/backup.sh

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰
echo "0 2 * * * /data/netbird/backup.sh >> /var/log/netbird-backup.log 2>&1" | crontab -
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å®˜æ–¹èµ„æº
- ğŸ“š [NetBird å®˜æ–¹æ–‡æ¡£](https://docs.netbird.io/)
- ğŸ™ [GitHub é¡¹ç›®](https://github.com/netbirdio/netbird)
- ğŸ’¬ [ç¤¾åŒºè®¨è®º](https://github.com/netbirdio/netbird/discussions)

### éƒ¨ç½²æ”¯æŒ
å¦‚é‡é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼š`lsb_release -a`
2. æœåŠ¡çŠ¶æ€ï¼š`docker-compose ps`
3. é”™è¯¯æ—¥å¿—ï¼š`docker-compose logs [æœåŠ¡å]`
4. ç½‘ç»œé…ç½®ï¼š`sudo ufw status`

---

## â±ï¸ é¢„è®¡éƒ¨ç½²æ—¶é—´

| é˜¶æ®µ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| ä¾èµ–å®‰è£… | 2-3åˆ†é’Ÿ | Dockerã€å·¥å…·åŒ…å®‰è£… |
| æ•°æ®åº“å¯åŠ¨ | 1-2åˆ†é’Ÿ | PostgreSQL åˆå§‹åŒ– |
| æœåŠ¡å¯åŠ¨ | 3-5åˆ†é’Ÿ | NetBird å„æœåŠ¡å¯åŠ¨ |
| é…ç½®éªŒè¯ | 2-3åˆ†é’Ÿ | å¥åº·æ£€æŸ¥å’Œæµ‹è¯• |
| **æ€»è®¡** | **8-15åˆ†é’Ÿ** | å–å†³äºç½‘ç»œå’ŒæœåŠ¡å™¨æ€§èƒ½ |

---

**ğŸ‰ éƒ¨ç½²å®Œæˆåï¼Œä½ å°†æ‹¥æœ‰ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç”Ÿäº§å°±ç»ªçš„ NetBird VPN æœåŠ¡ï¼**